<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Happy Birthday Rimsha</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&family=Great+Vibes&display=swap" rel="stylesheet" />
    <style>
      body{
        margin:0;
        overflow:hidden;
        background:#000;
      }
      canvas{position:absolute; inset:0;}
      svg{display:none;}

      /* Content wrapper */
      .content{
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
        pointer-events: none;
        text-align: center;
      }

      /* Photo frame */
      .photo-frame {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        overflow: hidden;
        border: 4px solid #ff9ac6;
        box-shadow: 0 0 20px rgba(255,120,180,.7);
        margin-bottom: 20px;
        animation: floatPic 4s ease-in-out infinite;
      }
      .photo-frame img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* Text */
      h2{
        margin:0;
        line-height:1.2;
        font-weight:800;
        font-size: clamp(28px, 10vw, 56px);
        background: linear-gradient(270deg,#ffd6ec,#fff,#ff8abb,#ffd6ec);
        background-size:300% 300%;
        -webkit-background-clip:text; background-clip:text; color:transparent;
        animation: gradientShift 6s ease-in-out infinite;
        text-shadow: 0 0 20px rgba(255,120,180,.9);
      }
      h2 .name{
        display:block; font-family:'Great Vibes',cursive;
        font-size: clamp(36px, 12vw, 70px);
        color:#ff9ac6;
        text-shadow:0 0 25px #ff6aa9, 0 0 40px rgba(255,96,160,.7);
      }

      @keyframes gradientShift{
        0%{background-position:0% 50%}
        50%{background-position:100% 50%}
        100%{background-position:0% 50%}
      }
      @keyframes floatPic{
        0%,100%{transform:translateY(0);}
        50%{transform:translateY(-10px);}
      }

      /* Glow */
      .glow{position:absolute; inset:0; display:flex; justify-content:center; align-items:center; z-index:5; pointer-events:none;}
      .glow::before{
        content:""; width:min(82vmin,720px); height:min(82vmin,720px); border-radius:50%;
        background: conic-gradient(from 0deg, #ff7fb8, transparent 25%, #ffd6ec 50%, transparent 75%, #ff7fb8);
        filter: blur(40px); opacity:.32; animation:spin 12s linear infinite;
      }
      @keyframes spin{to{transform:rotate(360deg)}}

      /* Confetti */
      .confetti{position:absolute; inset:0; overflow:hidden; pointer-events:none; z-index:12}
      .confetti span{position:absolute; width:7px; height:10px; border-radius:2px; opacity:.85; transform:rotate(15deg)}

      /* Music UI */
      .controls { position: fixed; right: 12px; bottom: 12px; z-index: 30; display: flex; gap: 8px; }
      .btn { cursor: pointer; font: 14px system-ui, sans-serif; padding: 6px 10px; border-radius: 10px; border: 1px solid #444; background:#1d1d1d; color:#eee; opacity:.9; pointer-events:auto; }
      .btn:hover { opacity: 1 }
      .gate { position: fixed; inset: 0; display: grid; place-items: center; background: rgba(0,0,0,.85); color:#fff; z-index: 40; }
      .gate.hidden { display: none }
      .gate .card { text-align: center; padding: 20px 24px; border: 1px solid #333; border-radius: 14px; background: #121212; }
      .gate .card h1 { margin: 0 0 10px; font: 600 18px/1.2 system-ui, sans-serif; }
    </style>
  </head>
  <body>
    <!-- Heart path -->
    <svg viewBox="0 0 600 552">
      <path d="M300,107.77C284.68,55.67,239.76,0,162.31,0,64.83,0,0,82.08,0,171.71c0,.48,0,.95,0,1.43-.52,19.5,0,217.94,299.87,379.69v0l0,0,.05,0,0,0,0,0v0C600,391.08,600.48,192.64,600,173.14c0-.48,0-.95,0-1.43C600,82.08,535.17,0,437.69,0,360.24,0,315.32,55.67,300,107.77" fill="#ee5282"/>
    </svg>

    <div class="glow"></div>

    <!-- Photo + Text -->
    <div class="content">
      <div class="photo-frame">
        <img src="Rimsha.png" alt="Rimsha">
      </div>
      <h2>Happy<br>Birthday<br><span class="name">Rimsha ðŸ’–</span></h2>
    </div>

    <div class="confetti" id="confetti"></div>

    <!-- Music elements -->
    <audio id="bgm" preload="auto" loop playsinline></audio>

    <div id="gate" class="gate" role="dialog" aria-modal="true">
      <div class="card">
        <h1>Tap to start the music</h1>
        <p>Then enjoy the animation.</p>
        <button id="gateStart" class="btn">Start</button>
      </div>
    </div>

    <div class="controls">
      <button id="playPause" class="btn">Play</button>
      <button id="mute" class="btn">Unmute</button>
    </div>

    <!-- libs -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>

    <!-- Heart + Confetti -->
    <script>
      const isMobile = matchMedia("(max-width: 480px)").matches;
      const DPR = Math.min(window.devicePixelRatio||1, isMobile?1.25:2);
      const STEP = isMobile?0.3:0.15;
      const POINT_SIZE = isMobile?2.4:3.0;
      const CONFETTI_COUNT = isMobile?20:45;

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,5000);
      camera.position.z=600;

      const renderer=new THREE.WebGLRenderer({antialias:!isMobile,powerPreference:"high-performance"});
      renderer.setPixelRatio(DPR);
      renderer.setSize(window.innerWidth,window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const controls=new THREE.OrbitControls(camera,renderer.domElement);
      controls.enableZoom=false;

      const path=document.querySelector("path");
      const length=path.getTotalLength();
      const vertices=[];
      const tl=gsap.timeline({repeat:-1,yoyo:true});
      for(let i=0;i<length;i+=STEP){
        const point=path.getPointAtLength(i);
        const v=new THREE.Vector3(point.x-300,-point.y+250,0);
        v.x+=(Math.random()-.5)*30;
        v.y+=(Math.random()-.5)*30;
        v.z+=(Math.random()-.5)*70;
        vertices.push(v);
        tl.from(v,{x:0,y:0,z:0,ease:"power2.inOut",duration:"random(2,5)"},i*0.002);
      }
      const positions=new Float32Array(vertices.length*3);
      const geometry=new THREE.BufferGeometry();
      geometry.setAttribute('position',new THREE.BufferAttribute(positions,3));
      const material=new THREE.PointsMaterial({color:0xee5282,blending:THREE.AdditiveBlending,size:POINT_SIZE});
      const particles=new THREE.Points(geometry,material);
      scene.add(particles);

      gsap.fromTo(scene.rotation,{y:-0.2},{y:0.2,repeat:-1,yoyo:true,ease:"power2.inOut",duration:3});

      function render(){
        requestAnimationFrame(render);
        const pos=geometry.attributes.position.array;
        for(let i=0;i<vertices.length;i++){
          const v=vertices[i];
          pos[i*3]=v.x; pos[i*3+1]=v.y; pos[i*3+2]=v.z;
        }
        geometry.attributes.position.needsUpdate=true;
        controls.update();
        renderer.render(scene,camera);
      }
      render();

      window.addEventListener("resize",()=>{
        camera.aspect=window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth,window.innerHeight);
      });

      // Confetti
      const confetti=document.getElementById("confetti");
      const colors=["#ff4da6","#ffccff","#ff99cc","#ff6699","#ff3385","#ff80bf","#ffe6f2"];
      for(let i=0;i<CONFETTI_COUNT;i++){
        const c=document.createElement("span");
        c.style.left=Math.random()*100+"%";
        c.style.top="-12px";
        c.style.background=colors[(Math.random()*colors.length)|0];
        confetti.appendChild(c);
        const dur=4+Math.random()*4;
        gsap.to(c,{y:window.innerHeight+40,x:"random(-40,40)",rotation:Math.random()*360,duration:dur,repeat:-1,delay:Math.random()*dur,ease:"linear"});
      }
    </script>

    <!-- Music logic -->
    <script>
      (() => {
        const audioCandidates = ["./hbd.mp3"];
        const defaultVolume = 0.6;

        const audio   = document.getElementById('bgm');
        const gate    = document.getElementById('gate');
        const gateBtn = document.getElementById('gateStart');
        const playBtn = document.getElementById('playPause');
        const muteBtn = document.getElementById('mute');

        audio.volume = defaultVolume;

        function updateButtons() {
          playBtn.textContent = audio.paused ? 'Play' : 'Pause';
          muteBtn.textContent = audio.muted ? 'Unmute' : 'Mute';
        }

        async function startMusic() {
          try {
            await audio.play();
            gate.classList.add('hidden');
          } catch (err) {
            console.warn('Play blocked until click');
          }
          updateButtons();
        }

        gateBtn.addEventListener('click', startMusic);

        playBtn.addEventListener('click', async () => {
          if (audio.paused) await audio.play(); else audio.pause();
          updateButtons();
        });

        muteBtn.addEventListener('click', () => {
          audio.muted = !audio.muted;
          updateButtons();
        });

        (async () => {
          audio.src = audioCandidates[0];
          updateButtons();
        })();
      })();
    </script>
  </body>
</html>
